name: Rotar resultados de todas las loter칤as

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  rotar_todo:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Clonar repositorio
        uses: actions/checkout@v3

      - name: Rotar Lotto Activo
        run: |
          if [ -f data/lotto.json ]; then
            OLD=$(cat data/lotto.json)
            DIA1=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | head -1 | tr -d ' ')
            DIA2=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -2 | head -1 | tr -d ' ')
            DIA3=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -1 | tr -d ' ')
          else
            DIA1="19,29,15,18,21,36,27,1,9,22,1,29"
            DIA2="35,21,16,30,0,5,28,2,29,7,36,32"
            DIA3="28,8,30,27,1,32,7,0,17,24,2,19"
          fi

          # Ac치 ir칤a el n칰mero nuevo de hoy (simulado)
          NUEVO="30,23,21,2,36,16,35,20,11,1,5,0"

          cat > data/lotto.json << EOF
          {
            "resultados": [[$DIA2], [$DIA3], [$NUEVO]],
            "fecha_actualizacion": "$(date -Iseconds)"
          }
          EOF

      - name: Rotar Granja Millonaria
        run: |
          if [ -f data/granja.json ]; then
            OLD=$(cat data/granja.json)
            DIA1=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | head -1 | tr -d ' ')
            DIA2=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -2 | head -1 | tr -d ' ')
            DIA3=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -1 | tr -d ' ')
          else
            DIA1="19,29,15,18,21,36,27,1,9,22"
            DIA2="35,21,16,30,0,5,28,2,29,7"
            DIA3="28,8,30,27,1,32,7,0,17,24"
          fi

          # Ac치 ir칤a el n칰mero nuevo de hoy (simulado)
          NUEVO="30,23,21,2,36,16,35,20,11,1"

          cat > data/granja.json << EOF
          {
            "resultados": [[$DIA2], [$DIA3], [$NUEVO]],
            "fecha_actualizacion": "$(date -Iseconds)"
          }
          EOF

      - name: Rotar Guacharo Activo
        run: |
          if [ -f data/guacharo.json ]; then
            OLD=$(cat data/guacharo.json)
            DIA1=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | head -1 | tr -d ' ')
            DIA2=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -2 | head -1 | tr -d ' ')
            DIA3=$(echo "$OLD" | grep -oP '(?<="resultados": \[\[)[^\]]+' | tail -1 | tr -d ' ')
          else
            DIA1="19,29,15,18,21,36,27,1,9,22,1,29"
            DIA2="35,21,16,30,0,5,28,2,29,7,36,32"
            DIA3="28,8,30,27,1,32,7,0,17,24,2,19"
          fi

          NUEVO="30,23,21,2,36,16,35,20,11,1,5,0"

          cat > data/guacharo.json << EOF
          {
            "resultados": [[$DIA2], [$DIA3], [$NUEVO]],
            "fecha_actualizacion": "$(date -Iseconds)"
          }
          EOF

      - name: Guardar cambios
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add data/
          git diff --quiet && git diff --staged --quiet || git commit -m "游댃 Rotaci칩n autom치tica de todas las loter칤as"
          git push
